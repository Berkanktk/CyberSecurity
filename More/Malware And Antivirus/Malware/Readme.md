# Malware Introductory
This page contains introductory information about malware. It is intended to be a starting point for those interested in learning more about malware.

## What is the Purpose of Malware Analysis?
Malware analysis is the process of examining malware in order to understand its purpose and how it works. 

When analysing malware, it is important to consider the following:
* Point of Entry (PoE) I.e. Was it through spam that our e-mail filtering missed and the user opened the attachment? Let's review our spam filters and train our users better for future prevention!
* What are the indicators that malware has even been executed on a machine? Are there any files, processes, or perhaps any attempt of "un-ordinary" communication?
* How does the malware perform? Does it attempt to infect other devices? Does it encrypt files or install anything like a backdoor / Remote Access Tool (RAT)?
* Most importantly - can we ultimately prevent and/or detect further infection?!

## Understanding Malware Campaigns
Despite the many variants of malware, attacks can generally be classified into two types: **Targeted** and Mass **Campaign**.

### Targeted Attacks
A "Targeted" attack is just that - targeted. In most cases, malware attacks that occur this way are created for a specific purpose against a specific target. A great example of this type of purpose could be the [DarkHotel](https://www.kaspersky.co.uk/resource-center/threats/darkhotel-malware-virus-threat-definition) malware, whom is designed to steal information such as authentication details from government officials.

### Mass Campaigns
On the other hand, the "Mass Campaign" classification can be akin to many real life examples, and is the most common type of attacks. The entire purpose of this type of Malware is to infect as many devices as possible and perform whatever it may - regardless of target.

Companies such as Kaspersky to name one, track these campaigns (known as Advanced Persistent Threats (APTs) and often report on their infection rate and indicators, much akin to the real-life spread of a virus from the World Health Organisation (WHO). 

Kaspersky report on the "Crouching Yeti (Energetic Bear)" campaign, this campaign specifically targets the following:

* Industrial/machinery
* Manufacturing
* Pharmaceutical
* Construction
* Education
* Information technology

Whilst it this variant is technically targeted, there is a rather large scope of this variant of malware, and as such, can be considered as a "Mass Campaign" attack.

## Identifying if a Malware Attack has Happened
Much like any interaction with an Operating System, there is always remnants of such activity even if there is little trace...

Fortunately, malware (dependant on its variant) is largely obtrusive - in the sense that it leaves quite an extensive papertrail of evidence...Perfect for us analysers!

The ultimate process of a malware attack can be broken down into a few broad steps:

1. Delivery
2. Execution
3. Maintaining persistence (not always the case!)
4. Propagation (not always!)

These steps will generate lots of data. Namely: network traffic such as communicating with hosts, file system interaction like read/writes and modification.

Malware is essentially classified based upon the behaviours it produces to perform the steps listed above. For a famous example, Wannacry performs all four of these steps.

### Delivery
This could be of many methods, to name a few: USB (Stuxnet!), PDF attachments through "Phising" campaigns or vulnerability enumeration.

### Execution
Here's the main part of how we classify Malware. What does it actually do? If it encrypts files - it's Ransomware! If it records information like keystrokes or displays adware - we can classify it as Spyware.

We only understand this stage through analysing the sample, which is why analysis is important - and is what we'll be covering.

### Maintaining Persistence
It wouldn't make much sense for Malware authors to go through all the trouble of developing a piece of code that is capable of execution - just for it to execute and that's it...Gone.

This is where persistence comes in. This is where the malware will attempt to maintain its presence on the system. 

Imagine a keylogger has been installed, but you then restart your Computer 30 seconds later. Unless you've entered a lot of sensitive information in 30 seconds - that'll be of no use to the author.

### Persistence
This stage is largely why Malware is so "noisy", Malware employs many techniques, of which we'll be covering in-depth much later on. Essentially, this stage is just to make sure that the "execution" is worth its while.

### Propagation
Hey...If you can infect one device, why not infect more whilst you're at it? Again, this is another reason why Malware can be so noticeable. Host discovery generates a lot of network traffic, we'll come to this later.

---

> In Summary, there are two categories of fingerprints that malware may leave behind on a Host after an attack:

---

### Host Fingerprint
These are generally speaking the results of execution and any persistence performed by the Malware. For example, has a file been encrypted? Has any additional software been installed? These are two of many, many host-based signatures that are useful to know to prevent and check against further infection.

### Network Fingerprint
At an overview, this classification of signatures are the observation of any networking communication taking place during delivery, execution and propagation. For example, in Ransomware, where has the Malware contacted for Bitcoin payments?

Such as in the case of Wannacry, looking for a large amount of "Samba" Protocol communication attempts is a great indication of infection due to its use of "Eternalblue".

## Static Vs. Dynamic Analysis
There are two categories used when analysing malware, these are:

1. Static Analysis
2. Dynamic Analysis

Whilst the methods and tools used for these two categories are vastly different, they are essential in compositing an understanding of how a malware behaves.

### Static Analysis
Static Analysis is the process of examining a malware sample without executing it. This is done by examining the file itself, and the metadata associated with it.

### Dynamic Analysis
Dynamic Analysis is the process of executing a malware sample in a controlled environment in order to observe how it behaves next. This is done by executing the file in a virtual machine, or a sandboxed environment.

## Discussion of Provided Tools & Their Uses
Provided Static Analysis Tools:

### C:\Users\Analysis\Desktop\Tools\Static\PE Tools
* Dependency Walker (depends)
* PeID
* **PE Explorer**
* PEview
* ResourceHacker

### C:\Users\Analysis\Desktop\Tools\Static\Disassembly
* IDA Freeware
* WinDbg
  
### C:\Users\Analysis\Desktop\Tools\Sysinternalsuite
* ResourceHacker
  
### C:\Users\Analysis\Desktop\Tools\Dynamic
Debugging, out of scope for this page.

## Analysing Malware Through Checksums
MD5 "Checksums" are a prominent attribute in the malware Community. Because there can be many variants of a family of Ransomware, these MD5 "Checksums" are cryptographic "fingerprints" of the files. This allows a uniformed identification throughout the community - especially with automated Sandboxes. 

For example, say you have 20 files of unknown origin, you are able to identify their genus using their MD5 sum against websites such as [Virustotal](https://www.virustotal.com/gui/home/upload), if that MD5 "Checksum" has been previously analyzed - removing all the legwork for us!

For Windows the [HashTab](https://implbits.com/hashtab) application can be installed to view the MD5 "Checksum" of a file in the properties of the file.

## What is Obfuscation? / Packing
Packing is one form of obfuscation that malware Authors employ to prevent the analysis of programmes. There are both legitimate and malicious reasons as to why the Author of a program will want to prevent the decompiling of their program. 

For example, a legitimate reason is the protection of intellectual property!

In the same token, just because you write a program...Why should everyone have the right to "copy" your project? This is one of the justifiable reasons for obfuscation - it is yours at the end of the day! 

However, malware Authors employ obfuscation techniques such as packing - whilst for the same reasons, they do so with the intent to prevent people like us reversing it to understand its behaviours and ultimately with the aims of achieving infection.

## Introduction to Strings
"Strings" are essentially the ASCII / Text contents of a program...this could be anything from passwords for self-extracting zips, to bitcoin addresses in ransomware samples.

When analysing the contents of these strings, we can sometimes paint a fairly indicative picture of the behaviours of the programme - bitcoin wallets being used in ransomware.

## Introduction to Imports
The classification of IDA Freeware is arguable as the tool can be used for both static and dynamic analysis. Without going too in-depth regarding the differences, there are two classifications of tools like IDA Freeware:

* Disassemblers
* Debuggers

I'll allow you to explore the differences between these two types of tools and their use cases in your own time, but for contextual sake - Disassemblers reverse the compiled code of a program from machine code to human-readable instructions (assembly). This is limited to how the program represents itself in its current state! I.e. If the contents of an executable changes during execution - "Disassemblers" will not reflect this.

Whilst Debuggers deploy the same techniques used by "Disassemblers", "Debuggers" essentially facilitate execution of the program - where the analyser can view the changes made throughout each "step" of the program. These tools are great because a true picture of the program presents itself. However, if it is indeed malicious, you have now infected yourself.

With enough understanding, an analyser can introduce "breakpoints" (or pauses) at various stages of a program, where the program will execute up until a breakpoint. For example, sticking with the idea of Ransomware, an analyser can create a "breakpoint" within the application prior to the actual stage of encryption of files. This facilitates an analyser to view the various changes of a program during execution (such as unpacking or connecting to a remote server such as that in a botnet) up until the point of malicious infection.